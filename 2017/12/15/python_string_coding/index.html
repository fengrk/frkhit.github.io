<!doctype html>
<head>
    <meta charset="utf-8">
    <title>解决python中遇到的乱码问题</title>
    <link rel="stylesheet" href="/static/css/style.css">
    

</head>
<body class="box">

<nav class="nav-menu">
    <ul>
        <li><a href="/">首页</a></li>
        <li><a href="https://github.com/frkhit/frkhit.github.io">源码</a></li>
    </ul>
</nav>

<div class="container">

    <div class="content" role="main">
        
    <h1>解决python中遇到的乱码问题</h1>
    <p>2017-12-15</p>
    <h1>解决python中遇到的乱码问题</h1>
<h2>1. 解决中文乱码的一种可行方法</h2>
<p>`</p>
<h1>-<em>- coding:utf-8 -</em>-</h1>
<p>from <strong>future</strong> import unicode_literals</p>
<p>import chardet</p>
<p>def smart_decoder(raw_content, default_encoding_list=("utf-8", "gb18030")):
    """
    将字符串解码成unicode
    :type default_encoding_list: list of str
    :rtype: unicode
    :type raw_content: str|unicode
    """
    if isinstance(raw_content, unicode):
        return raw_content</p>
<pre><code>encoding = chardet.detect(raw_content).get("encoding", "utf-8")

try:
    return raw_content.decode(encoding)
except UnicodeEncodeError as e:
    for encoding in default_encoding_list:
        try:
            return raw_content.decode(encoding)
        except UnicodeEncodeError as e:
            pass
    raise e
</code></pre>
<p>if <strong>name</strong> == '<strong>main</strong>':
    import requests</p>
<pre><code>a = requests.get("https://www.baidu.com").content
print(smart_decoder(a))
</code></pre>
<p>`</p>
<h2>2. requests响应结果乱码</h2>
<h3>问题</h3>
<p>使用requests请求网址，获取响应response， 通过response.text得到的网页内容，有时候会出现乱码的情况。</p>
<h3>原因</h3>
<p>分析源代码发现，调用respose.text 其实就是对 response.content执行解码操作。编码通过chardet判断。</p>
<p>乱码的关键是，chardet获取的编码可能不正确，但在执行response.content.decode时，程序会直接忽略编码异常，从而导致使用错误的编码解码。</p>
<h3>解决思路</h3>
<p>人工解码，处理编码错误。</p>
<h3>程序demo</h3>
<p>```
def parse_response(response):
    """
    手工对requests的响应内容解码
    :rtype: unicode
    """
    return smart_decoder(response.content)</p>
<p>```</p>

    </div>

</div><!-- end container -->
<script src="/static/js/script.js"></script>
</body>
</html>